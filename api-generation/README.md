# API Generation Tools and Templates

A minimal demo of Dapr actors application in Go, demonstrating actor state management and method invocation patterns with schema-first development.

> **Note**: This documentation was largely generated by AI to provide comprehensive examples and explanations.

This directory contains tools, templates, and configurations for schema-first development.

## Overview

This module supports generating Go code from various API schema definitions, enabling schema-first development workflows where:

1. **API schemas are defined first** using standard schema languages
2. **Code is generated** from these schemas
3. **Implementation follows the schema** rather than the reverse

## Supported Schema Types

### OpenAPI 3.0 (✅ Currently Implemented)
- **Use Case**: REST APIs, HTTP services, Dapr actor APIs
- **Generation Target**: Go interfaces, types, schema validation
- **Tools**: Custom generators based on `kin-openapi`
- **Status**: Fully implemented and tested

### Future Support
Additional schema types can be added when needed:
- **Protocol Buffers**: For gRPC services and high-performance APIs
- **JSON Schema**: For data validation and simple type definitions  
- **GraphQL SDL**: For GraphQL APIs and flexible query interfaces
- **AsyncAPI**: For event-driven APIs and messaging systems

## Directory Structure

```
api-generation/                    # Schema-first development tools
├── schemas/openapi/               # OpenAPI 3.0 specifications (source)
├── tools/                         # Generation tools and scripts
│   ├── bin/                       # Installed tool binaries
│   └── scripts/                   # Installation and generation scripts
└── docs/                          # Documentation and examples

# Generated code is organized by actor type:
../internal/counteractor/          # Complete counter actor package
│   ├── api.go                     # Generated interfaces and constants
│   ├── factory.go                 # Factory functions for actor registration
│   ├── types.go                   # Generated type definitions
│   └── counter.go                 # Implementation (manually written)
../internal/bankaccountactor/      # Complete bank account actor package
    ├── api.go                     # Generated interfaces and constants
    ├── factory.go                 # Factory functions for actor registration
    ├── types.go                   # Generated type definitions
    └── bankaccount.go             # Implementation (manually written)
```

## Key Principles

### Separation of Concerns
1. **Schemas** (`schemas/`): Source of truth API schemas
2. **Tooling** (`tools/`): Generation and validation tools  
3. **Generated Code**: Output organized by functional units (actor types) rather than technical layers
4. **Documentation** (`docs/`): Workflows, examples, and guidance

### Actor Package Organization
Each actor type gets its own complete package containing:
- **Generated code**: API interfaces, types, and factory functions
- **Implementation**: Manually written actor logic
- **Self-contained**: All dependencies for that actor type in one place

This functional organization provides better cohesion and reduced coupling compared to technical layer separation.

### Tool Installation Strategy
Only currently implemented tools are installed:
- ✅ **OpenAPI tools**: Custom generators based on `kin-openapi` (actively used and tested)
- ⏳ **Other tools**: Can be added when needed
│## Quick Start

### 1. Install Tools
```bash
cd api-generation
./tools/scripts/install.sh
```

### 2. Generate Code from Schema
```bash
# Generate from OpenAPI (only currently supported format)
./tools/scripts/generate.sh openapi schemas/openapi/multi-actors.yaml

# Generated code is organized by actor type:
ls ../internal/counteractor/      # api.go factory.go types.go counter.go  
ls ../internal/bankaccountactor/  # api.go factory.go types.go bankaccount.go
```

The generator directly creates actor-specific packages containing:
- `api.go` - Generated interfaces and constants
- `factory.go` - Factory functions for actor registration  
- `types.go` - Generated type definitions
- `{actor}.go` - Implementation files (manually written)

### 3. Use Generated Code in Your Application
```go
import "github.com/shogotsuneto/dapr-actor-experiment/internal/counteractor"

// Implementation struct embeds actor.ServerContext via the generated API interface
type CounterActor struct {
    counteractor.CounterActorAPI  // Embeds actor.ServerContext
}

func (c *CounterActor) Increment(ctx context.Context) (*counteractor.CounterState, error) {
    // Implementation MUST match the OpenAPI schema
}

// Register actor using generated factory
func main() {
    s := daprd.NewService(":8080")
    s.RegisterActorImplFactoryContext(counteractor.NewActorFactory())
    s.Start()
}
```

## Integration with Main Server

The main Dapr server (`cmd/server`) uses the schema-based CounterActor implementation with generated OpenAPI types for type safety and schema compliance.

Check the `/status` endpoint to see actor information.